app:
  runtime:
    name: nodejs20.x
  id: ari:cloud:ecosystem::app/YOUR_APP_ID

modules:
  jira:issuePanel:
    - key: ac-writer-panel
      title: AC Writer
      resource: main
      resolver:
        function: resolver

  function:
    - key: resolver
      handler: index.handler
    - key: fetch-issue-details
      handler: actions.fetchIssueDetails
    - key: generate-criteria
      handler: actions.generateCriteria
    - key: update-issue-description
      handler: actions.updateIssueDescription

  rovo:agent:
    - key: ac-generator-agent
      name: Acceptance Criteria Generator
      description: Expert Business Analyst that generates Gherkin-format acceptance criteria
      prompt: |
        You are an expert Business Analyst and Product Owner specializing in writing clear, testable acceptance criteria in Gherkin format.
        
        Your role:
        - Analyze Jira ticket information (summary, description, issue type)
        - Generate 2-4 structured Gherkin scenarios
        - Always include at least one happy path scenario
        - Always include at least one error/edge case scenario
        - Use proper Gherkin keywords: Given, When, Then, And, But
        
        Output Format (STRICT):
        **Acceptance Criteria**
        
        **Scenario 1: [Descriptive Name]**
        **Given** [precondition]
        **And** [additional precondition if needed]
        **When** [user action]
        **And** [additional action if needed]
        **Then** [expected outcome]
        **And** [additional outcome if needed]
        
        **Scenario 2: [Error/Edge Case Name]**
        **Given** [precondition]
        **When** [action that triggers error]
        **Then** [expected error handling]
        
        Rules:
        - Be specific and testable (avoid "properly", "correctly", "successfully" without details)
        - Use domain-appropriate terminology
        - Keep scenarios concise but complete
        - If ticket is vague, ask clarifying questions before generating
        - Consider common edge cases for the feature type
        
        Context you'll receive:
        - Ticket Summary
        - Ticket Description (if exists)
        - Issue Type (Story/Task/Bug/etc)
      conversationStarters:
        - text: Generate acceptance criteria for this ticket
        - text: Create Gherkin scenarios with edge cases
        - text: What clarifications do you need to write better criteria?
      actions:
        - key: fetch-issue-details
        - key: generate-criteria
        - key: update-issue-description

  rovo:action:
    - key: fetch-issue-details
      function: fetch-issue-details
      description: Retrieves current Jira issue summary, description, and issue type
      input:
        type: object
        properties:
          issueKey:
            type: string
            description: The Jira issue key
      output:
        type: object
        properties:
          summary:
            type: string
          description:
            type: string
          issueType:
            type: string
    
    - key: generate-criteria
      function: generate-criteria
      description: Generates Gherkin acceptance criteria based on ticket data
      input:
        type: object
        properties:
          summary:
            type: string
          description:
            type: string
          issueType:
            type: string
      output:
        type: object
        properties:
          criteria:
            type: string
    
    - key: update-issue-description
      function: update-issue-description
      description: Updates the Jira issue description with generated acceptance criteria
      input:
        type: object
        properties:
          issueKey:
            type: string
          criteria:
            type: string
      output:
        type: object
        properties:
          success:
            type: boolean

resources:
  - key: main
    path: src/frontend/index.jsx

permissions:
  scopes:
    - read:jira-work
    - write:jira-work
    - storage:app
